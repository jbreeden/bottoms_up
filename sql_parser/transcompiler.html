<html>
  <head>
    <script src="underscore.js"></script>
    <script src="jquery.js"></script>
    <script src="trace.js"></script>
    <script src="lexer.js"></script>
    <script src="parser.js"></script>
    <script src="lex-sql.js"></script>
    <script src="parse-sql.js"></script>
    <style>
.test {
  margin-bottom: 10px;
}

.test, .test textarea {
  font-size: 10pt;
}

.test .column {
  display: inline-block;
  padding: auto 0 auto 0;
}

.test textarea {
  display: inline-block;
}
    </style>
  </head>
  <body>
    <script>

parser = new SQLParser();
parser.setTraceLevel(Trace.debug);

function test(title, sql) {
  test.number = test.number || 0;
  $('body').append($(
    "<div id='test" + test.number + "' class='test'>" +
      "<h1>" + title + "</h1>" +
      "<div class='column'>SQL<br/><textarea class='sql-input' rows='20' cols='30'>" +
        sql +
      "</textarea></div>" +
      "<div class='column'>AST<br/><textarea class='ast' rows='20' cols='30'>" +
      "</textarea></div>" +
      "<div class='column'>Query<br/><textarea class='query' rows='20' cols='30'>" +
      "</textarea></div>" +
      "<div class='column'>SPL<br/><textarea class='spl' rows='20' cols='30'>" +
      "</textarea></div>" +
      "<div><button class='refresh' onclick='refresh(" + test.number + ")'>Refresh</button></div>" +
    "</div>"
  ).get(0));
  refresh(test.number);
  test.number++;
}

function refresh (testNumber) {
  var $test = $("#test" + testNumber)
  try {
    parser.transcompile($test.find(".sql-input").val(), function (error, ast, query) {
      if (error) {
        $test.find('.ast').val(error);
        $test.find('.query').val('');
        $test.find('.spl').val('');
      } else {
        $test.find('.ast').val(JSON.stringify(ast, null, 2));
        $test.find('.query').val(JSON.stringify(query, null, 2));
        $test.find('.spl').val(query.toSPL());
        console.log(ast);
        console.log(query);
        console.log(query.toSPL());
      }
    });
  } catch (ex) {
    error = ex;
  }
}

test('Select *', 'select * \nfrom git');
test('Select Fields', 'select author_name, author_date \nfrom git');
test('Filter', 'select sha, author_date \nfrom git\nwhere author_name = \'Brian Krueger\'');
test('Alias', 'select this as that, other from git where something < 5');
test('Select * and Alias', 'select col as my_col, *\nfrom git');
test('Comments', '\n-- All Fields\nselect * \n--From the git index\nfrom git \n--Where some field < 5\nwhere something < 5');
test('Limit', 'select *\nfrom default\nlimit 100');
test('Order By', 'select *\nfrom default\norder by name');
test('All Out', 'select last_name as "Last Name"\nfrom index\nwhere name = \'steve\' \ngroup by last_name \nhaving last_name like \'%Burg%\'\norder by last_name\nlimit 100')

    </script>
  </body>
</html>
